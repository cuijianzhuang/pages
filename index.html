<html class="HomePage">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"><title>CJZ's Home</title>
    <!-- 使用独立的主题管理系统 -->
    <script src="./js/theme-storage.js"></script>
    <script src="./js/theme-loader.js"></script>
    <!-- 添加内联样式，防止加载闪烁 -->
    <style>
      #app {
        background-color: transparent !important;
        backdrop-filter: none !important;
        -webkit-backdrop-filter: none !important;
        box-shadow: none !important;
        border: none !important;
      }
      
      /* 页面加载时的菜单和引用区域样式 */
      .menu .link {
        background-color: transparent !important;
        border: none !important;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.9);
      }
      
      .quote-section {
        background-color: transparent !important;
        border: none !important;
      }
    </style>
    <link rel="stylesheet" href="./css/index.css">
    <link rel="stylesheet" href="./css/datetime-compact.css">
    <link rel="stylesheet" href="./css/font-awesome.min.css">
    <link rel="stylesheet" href="./css/player.css">
    <link rel="stylesheet" href="./css/stars.css">
    <link rel="stylesheet" href="./css/snow.css">
    <!-- Add Sakana Widget CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sakana-widget@2.7.0/lib/sakana.min.css">
  </head>
  <body>
    <canvas id="particles"></canvas>
    <!-- Add Sakana Widget container -->
    <div id="sakana-widget" style="position: fixed; right: 0; bottom: 0; z-index: 100;"></div>
    <div id="app">
      <h2 class="title title-typing">崔健壮</h2>
<!--  <p class="description">想让所有人认识我，却不知道我是谁</p>-->
      <div class="fade-in-text delay-2">
        <p class="description letter-animation">
          <span>C</span><span>a</span><span>r</span><span>p</span><span>e</span><span>&nbsp;</span><span>d</span><span>i</span><span>e</span><span>m</span><span>,</span><span>&nbsp;</span><span>Q</span><span>u</span><span>a</span><span>m</span><span>&nbsp;</span><span>m</span><span>i</span><span>n</span><span>i</span><span>m</span><span>u</span><span>m</span><span>&nbsp;</span><span>c</span><span>r</span><span>e</span><span>d</span><span>u</span><span>l</span><span>a</span><span>&nbsp;</span><span>p</span><span>o</span><span>s</span><span>t</span><span>e</span><span>r</span><span>o</span><span>.</span>
        </p>
      </div>
<!--   添加一言api-->
      <div class="hitokoto fade-in-text delay-3">
        <span id="hitokoto-text">获取中...</span>
        <div id="hitokoto-from"></div>
      </div>
      
      <div class="datetime-container fade-in-text delay-4">
        <div class="datetime-display">
          <div class="current-time">
            <span id="current-time-text">00:00:00</span>
          </div>
          <div class="current-date">
            <span id="current-date-text">2024年1月1日</span>
            <span class="weekday" id="current-weekday">星期一</span>
          </div>
          <div class="lunar-date">
            <span id="lunar-date-text">甲辰龙年 正月初一</span>
          </div>
        </div>
      </div>
      <div class="menu fade-in-text delay-5">
        <a href="https://blog.cuijianzhuang.com/" title="Blog" class="link" target="_blank">Blog</a>
<!--        <a href="https://pan.cuijianzhuang.com/" title="网盘" class="link" target="_blank">Alist Drive</a>-->
        <a href="https://panel.cuijianzhuang.com/" title="1panel" class="link" target="_blank">1Panel</a>
        <a href="https://mail.cuijianzhuang.com/" title="Cloudflare 临时邮件" class="link" target="_blank">邮箱</a>
<!--        <a href="https://state.cuijianzhuang.com/" title="哪吒监控" class="link" target="_blank">探针</a>-->
        <a href="https://server.cuijianzhuang.com/" title="UptimeFlare" class="link" target="_blank">服务</a>

      </div>
      <div class="menu-icons fade-in-text delay-6">
        <div class="settings-toggle">
          <i aria-hidden="true" class="fa fa-2x fa-cog"></i>
        </div>
        <div class="theme-toggle">
          <i aria-hidden="true" class="fa fa-2x fa-moon-o"></i>
        </div>
        <div class="snow-toggle">
          <i aria-hidden="true" class="fa fa-2x fa-snowflake-o"></i>
        </div>
        <a href="https://github.com/cuijianzhuang" target="_blank">
          <i aria-hidden="true" class="fa fa-2x fa-github"></i>
        </a>
      </div>
      
      <div class="quote-section fade-in-text delay-7">
        <span class="heart-icon">❤️</span> 
        <span class="quote-text">有趣的人终将相遇</span> 
        <span class="heart-icon">❤️</span>
      </div>
      
      <p class="footer fade-in-text delay-8">
        Copyright © 2024-<span id="currentYear"></span>
        <span class="footer-divider">·</span>
        <a href="about.html" class="about-link">About</a>
      </p>
    </div>

    <!-- Settings Panel -->
    <div class="settings-panel">
      <div class="settings-header">
        <h3>设置</h3>
        <i class="fa fa-times close-settings"></i>
      </div>
      <div class="settings-content">
        <div class="setting-item">
          <span>点击特效</span>
          <label class="switch">
            <input type="checkbox" id="click-effects-toggle" checked>
            <span class="slider round"></span>
          </label>
        </div>
        <div class="setting-item">
          <span>鼠标轨迹</span>
          <label class="switch">
            <input type="checkbox" id="mouse-trail-toggle">
            <span class="slider round"></span>
          </label>
        </div>
        <!-- Add Sakana Widget toggle -->
        <div class="setting-item">
          <span>看板娘</span>
          <label class="switch">
            <input type="checkbox" id="sakana-widget-toggle" checked>
            <span class="slider round"></span>
          </label>
        </div>
        <div class="setting-item">
          <span>必应壁纸</span>
          <label class="switch">
            <input type="checkbox" id="bing-wallpaper-toggle" checked>
            <span class="slider round"></span>
          </label>
        </div>
      </div>
    </div>

    <!-- https://github.com/metowolf/MetingJS -->
    <!-- require APlayer -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css">
    <script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script>
    <!-- require MetingJS -->
    <script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script>
    <!--本地js引入-->
    <script src="./js/config.js"></script>
    <script src="./js/api-manager.js"></script>
    <script src="./js/lunar-calendar.js"></script>
    <script src="./js/particles.js" defer></script>
    <script src="./js/main.js" defer></script>
    <script src="./js/stars.js" defer></script>
    <script src="./js/snow.js" defer></script>
    <script src="./js/settings.js" defer></script>
    <meting-js server="netease"
               type="playlist"
               id="961896580"
               fixed="true"
               mini="true"
               autoplay="true"
               order="random"
               volume="0.2"
               mutex="true"
               storage-name	="metingjs"
    >
    </meting-js>
    <!-- 简化的初始化脚本 -->
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        // 基础效果初始化
        new SnowEffect();
        window.starEffect = new StarEffect();
        
        // 初始化日期时间显示
        window.dateTimeDisplay = new DateTimeDisplay();
        
        // 其他功能由独立模块处理
        // Settings类将在其自己的文件中自动初始化
      });
    </script>

    <script>
        function initSakanaWidget() {
            // 从cookie中读取状态
            const cookies = document.cookie.split(';');
            const sakanaWidget = cookies.find(cookie => cookie.trim().startsWith('sakanaWidget='));
            const enabled = sakanaWidget ? sakanaWidget.split('=')[1].trim() === 'true' : true;

            if (!enabled) {
                document.getElementById('sakana-widget').style.display = 'none';
                return;
            }
            
            const sakana = new SakanaWidget(sakanaConfig.rightWidget).mount('#sakana-widget');
        }
    </script>
    <script
        async
        onload="initSakanaWidget()"
        src="https://cdn.jsdelivr.net/npm/sakana-widget@2.7.0/lib/sakana.min.js"
    ></script>
    
    <!-- 修复脚本 - 解决theme-debug.js和预加载undefined问题 -->
    <script>
      (function() {
        console.log('🔧 执行快速修复...');
        
        // 修复1: 移除theme-debug.js已在HTML中处理
        
        // 修复2: 修复预加载壁纸的undefined问题
        setTimeout(() => {
          if (window.wallpaperManager) {
            const originalPreload = window.wallpaperManager.preloadNextWallpaper;
            
            window.wallpaperManager.preloadNextWallpaper = async function() {
              if (!this.preloadEnabled) return;
              
              console.log('🔮 开始预加载下一张壁纸（修复版本）...');
              try {
                // 安全获取配置
                const endpoints = CONFIG?.BING_WALLPAPER?.FALLBACK_ENDPOINTS || [];
                const mainEndpoint = CONFIG?.BING_WALLPAPER?.ENDPOINT;
                
                let preloadUrl;
                if (endpoints.length > 0) {
                  preloadUrl = endpoints[0] + '&t=' + (Date.now() + 1000);
                } else if (mainEndpoint) {
                  preloadUrl = mainEndpoint + '?t=' + (Date.now() + 1000);
                } else {
                  preloadUrl = 'https://bing.img.run/rand.php?t=' + (Date.now() + 1000);
                }
                
                // 验证URL
                if (!preloadUrl || preloadUrl.includes('undefined')) {
                  console.error('❌ 预加载URL无效，跳过');
                  return;
                }
                
                await window.apiManager.requestImageFast(preloadUrl);
                console.log('✅ 预加载完成（修复版本）');
              } catch (error) {
                console.log('⚠️ 预加载失败（已修复）:', error.message);
              }
            };
            
            console.log('✅ 预加载函数已修复');
          }
        }, 1000);
        
        console.log('✅ 快速修复完成');
      })();
    </script>
  </body>
</html>
