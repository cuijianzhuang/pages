<html class="HomePage">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"><title>CJZ's Home</title>
    <!-- 添加内联脚本，提前标记壁纸状态并设置主题 -->
    <script>
      (function() {
        // 初始化必要的CSS变量
        const lightThemeVars = {
          '--bg-color': '#f5f5f5',
          '--text-color': '#8b7355',
          '--link-bg': '#e8e8e8',
          '--link-hover-bg': '#8b7355',
          '--link-hover-text': '#ffffff',
          '--shadow-color': 'rgba(139, 115, 85, 0.3)',
          '--app-bg': 'rgba(245, 245, 245, 0.75)',
          '--overlay-color': 'rgba(255, 255, 255, 0)'
        };
        
        const darkThemeVars = {
          '--bg-color': '#121212',
          '--text-color': '#c1a86a',
          '--link-bg': '#0d0d0d',
          '--link-hover-bg': '#c1a86a',
          '--link-hover-text': '#0c0c0c',
          '--shadow-color': 'rgba(193, 168, 106, 0.3)',
          '--app-bg': 'rgba(18, 18, 18, 0.75)',
          '--overlay-color': 'rgba(0, 0, 0, 0.5)'
        };
        
        // 壁纸标记
        document.documentElement.setAttribute('data-loading-wallpaper', 'true');
        
        // 获取主题设置并立即应用
        function getCookie(name) {
          const value = `; ${document.cookie}`;
          const parts = value.split(`; ${name}=`);
          if (parts.length === 2) return parts.pop().split(';').shift();
          return null;
        }
        
        // 获取保存的主题
        const savedTheme = getCookie('theme');
        const theme = savedTheme || (function() {
          // 如果没有保存的主题，默认使用时间判断
          const hour = new Date().getHours();
          const isDay = hour >= 6 && hour < 18;
          return isDay ? 'light-theme' : 'dark-theme';
        })();
        
        // 清除可能存在的其他主题类
        document.body.classList.remove('light-theme', 'dark-theme');
        // 应用主题类
        document.body.classList.add(theme);
        
        // 应用CSS变量
        const themeVars = theme === 'light-theme' ? lightThemeVars : darkThemeVars;
        for (const [prop, value] of Object.entries(themeVars)) {
          document.documentElement.style.setProperty(prop, value);
        }
        
        // 如果没有保存过主题，保存当前主题
        if (!savedTheme) {
          document.cookie = `theme=${theme};path=/`;
        }
        
        console.log('初始主题已设置为:', theme);
      })();
    </script>
    <!-- 添加内联样式，防止加载闪烁 -->
    <style>
      #app {
        background-color: transparent !important;
        backdrop-filter: none !important;
        -webkit-backdrop-filter: none !important;
        box-shadow: none !important;
        border: none !important;
      }
      
      /* 页面加载时的菜单和引用区域样式 */
      .menu .link {
        background-color: transparent !important;
        border: none !important;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.9);
      }
      
      .quote-section {
        background-color: transparent !important;
        border: none !important;
      }
    </style>
    <link rel="stylesheet" href="./css/index.css">
    <link rel="stylesheet" href="./css/font-awesome.min.css">
    <link rel="stylesheet" href="./css/player.css">
    <link rel="stylesheet" href="./css/stars.css">
    <link rel="stylesheet" href="./css/snow.css">
    <!-- Add Sakana Widget CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sakana-widget@2.7.0/lib/sakana.min.css">
  </head>
  <body>
    <canvas id="particles"></canvas>
    <!-- Add Sakana Widget container -->
    <div id="sakana-widget" style="position: fixed; right: 0; bottom: 0; z-index: 100;"></div>
    <div id="app">
      <h2 class="title title-typing">崔健壮</h2>
<!--  <p class="description">想让所有人认识我，却不知道我是谁</p>-->
      <div class="fade-in-text delay-2">
        <p class="description letter-animation">
          <span>C</span><span>a</span><span>r</span><span>p</span><span>e</span><span>&nbsp;</span><span>d</span><span>i</span><span>e</span><span>m</span><span>,</span><span>&nbsp;</span><span>Q</span><span>u</span><span>a</span><span>m</span><span>&nbsp;</span><span>m</span><span>i</span><span>n</span><span>i</span><span>m</span><span>u</span><span>m</span><span>&nbsp;</span><span>c</span><span>r</span><span>e</span><span>d</span><span>u</span><span>l</span><span>a</span><span>&nbsp;</span><span>p</span><span>o</span><span>s</span><span>t</span><span>e</span><span>r</span><span>o</span><span>.</span>
        </p>
      </div>
<!--   添加一言api-->
      <div class="hitokoto fade-in-text delay-3">
        <span id="hitokoto-text">获取中...</span>
        <div id="hitokoto-from"></div>
      </div>
      <!--
      <div class="datetime-weather">
        <div id="datetime">
          <span id="date"></span>
          <span id="time"></span>
        </div>
        <div id="weather">
          <span id="weather-info">获取天气中...</span>
        </div>
      </div>
      -->
      <div class="menu fade-in-text delay-4">
        <a href="https://blog.cuijianzhuang.com/" title="Rin Blog" class="link" target="_blank">Blog</a>
        <a href="https://pan.cuijianzhuang.com/" title="alist 网盘" class="link" target="_blank">Alist Drive</a>
        <a href="https://panel.cuijianzhuang.com/" title="1panel" class="link" target="_blank">1Panel</a>
        <a href="https://mail.cuijianzhuang.com/" title="Cloudflare 临时邮件" class="link" target="_blank">邮箱</a>
<!--        <a href="https://state.cuijianzhuang.com/" title="哪吒监控" class="link" target="_blank">探针</a>-->
        <a href="https://server.cuijianzhuang.com/" title="UptimeFlare" class="link" target="_blank">服务</a>

      </div>
      <div class="menu-icons fade-in-text delay-5">
        <div class="settings-toggle">
          <i aria-hidden="true" class="fa fa-2x fa-cog"></i>
        </div>
        <div class="theme-toggle">
          <i aria-hidden="true" class="fa fa-2x fa-moon-o"></i>
        </div>
        <div class="snow-toggle">
          <i aria-hidden="true" class="fa fa-2x fa-snowflake-o"></i>
        </div>
        <a href="https://github.com/cuijianzhuang" target="_blank">
          <i aria-hidden="true" class="fa fa-2x fa-github"></i>
        </a>
      </div>
      
      <div class="quote-section fade-in-text delay-6">
        <span class="heart-icon">❤️</span> 
        <span class="quote-text">有趣的人终将相遇</span> 
        <span class="heart-icon">❤️</span>
      </div>
      
      <p class="footer fade-in-text delay-7">
        Copyright © 2024-<span id="currentYear"></span>
        <span class="footer-divider">·</span>
        <a href="about.html" class="about-link">About</a>
      </p>
    </div>

    <!-- Settings Panel -->
    <div class="settings-panel">
      <div class="settings-header">
        <h3>设置</h3>
        <i class="fa fa-times close-settings"></i>
      </div>
      <div class="settings-content">
        <div class="setting-item">
          <span>点击特效</span>
          <label class="switch">
            <input type="checkbox" id="click-effects-toggle" checked>
            <span class="slider round"></span>
          </label>
        </div>
        <div class="setting-item">
          <span>鼠标轨迹</span>
          <label class="switch">
            <input type="checkbox" id="mouse-trail-toggle" checked>
            <span class="slider round"></span>
          </label>
        </div>
        <!-- Add Sakana Widget toggle -->
        <div class="setting-item">
          <span>看板娘</span>
          <label class="switch">
            <input type="checkbox" id="sakana-widget-toggle" checked>
            <span class="slider round"></span>
          </label>
        </div>
        <div class="setting-item">
          <span>必应壁纸</span>
          <label class="switch">
            <input type="checkbox" id="bing-wallpaper-toggle" checked>
            <span class="slider round"></span>
          </label>
        </div>
      </div>
    </div>

    <!-- https://github.com/metowolf/MetingJS -->
    <!-- require APlayer -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css">
    <script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script>
    <!-- require MetingJS -->
    <script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script>
    <!--本地js引入-->
    <script src="./js/config.js"></script>
    <script src="./js/particles.js" defer></script>
    <script src="./js/main.js" defer></script>
    <script src="./js/stars.js" defer></script>
    <script src="./js/snow.js" defer></script>
    <script src="./js/settings.js" defer></script>
    <meting-js server="netease"
               type="playlist"
               id="961896580"
               fixed="true"
               mini="true"
               autoplay="true"
               order="random"
               volume="0.2"
               mutex="true"
               storage-name	="metingjs"
    >
    </meting-js>
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        new SnowEffect();
        // 初始化鼠标轨迹效果
        window.starEffect = new StarEffect();
        
        // 设置面板切换 - 直接替换settings.js中的处理
        const settingsToggle = document.querySelector('.settings-toggle');
        const settingsPanel = document.querySelector('.settings-panel');
        const closeSettings = document.querySelector('.close-settings');
        
        // 确保settings.js的事件监听器不会被添加 - 通过标记
        if (settingsToggle) {
          window._settingsInitialized = true;
        }
        
        // 设置面板显示/隐藏
        if (settingsToggle && settingsPanel) {
            console.log('正在为设置按钮添加事件监听器');
            
            // 移除可能存在的事件监听器
            const oldToggle = settingsToggle.cloneNode(true);
            settingsToggle.parentNode.replaceChild(oldToggle, settingsToggle);
            
            // 重新获取DOM引用
            const newSettingsToggle = document.querySelector('.settings-toggle');
            
            // 添加新的点击事件
            newSettingsToggle.addEventListener('click', (e) => {
                e.stopPropagation();
                settingsPanel.classList.toggle('show');
                console.log('设置面板', settingsPanel.classList.contains('show') ? '已显示' : '已隐藏');
            });
            
            if (closeSettings) {
                // 移除可能存在的事件监听器
                const oldCloseBtn = closeSettings.cloneNode(true);
                closeSettings.parentNode.replaceChild(oldCloseBtn, closeSettings);
                
                // 重新获取DOM引用
                const newCloseSettings = document.querySelector('.close-settings');
                
                // 添加新的点击事件
                newCloseSettings.addEventListener('click', () => {
                    settingsPanel.classList.remove('show');
                    console.log('设置面板已关闭');
                });
            }
            
            // 处理点击外部区域关闭面板
            if (window._documentClickHandler) {
                document.removeEventListener('click', window._documentClickHandler);
            }
            
            window._documentClickHandler = (e) => {
                if (settingsPanel.classList.contains('show') && 
                    !settingsPanel.contains(e.target) && 
                    !newSettingsToggle.contains(e.target)) {
                    settingsPanel.classList.remove('show');
                    console.log('点击外部区域，设置面板已关闭');
                }
            };
            document.addEventListener('click', window._documentClickHandler);
        }
        
        // 添加直接的主题切换处理
        const themeToggle = document.querySelector('.theme-toggle');
        if (themeToggle) {
          // 移除可能存在的事件监听器
          const oldThemeToggle = themeToggle.cloneNode(true);
          themeToggle.parentNode.replaceChild(oldThemeToggle, themeToggle);
          
          // 重新获取DOM引用
          const newThemeToggle = document.querySelector('.theme-toggle');
          const themeIcon = newThemeToggle.querySelector('i');
          
          // 初始更新图标
          const currentTheme = document.body.classList.contains('light-theme');
          themeIcon.classList.remove('fa-sun-o', 'fa-moon-o');
          themeIcon.classList.add(currentTheme ? 'fa-moon-o' : 'fa-sun-o');
          console.log('初始主题图标设置为:', currentTheme ? '月亮(深色)' : '太阳(亮色)');
          
          // 添加点击事件
          newThemeToggle.addEventListener('click', function(e) {
            // 阻止事件冒泡
            e.stopPropagation();
            console.log('主题切换按钮被点击');
            
            // 添加旋转动画
            newThemeToggle.classList.add('rotating');
            
            // 切换主题
            const isLight = document.body.classList.contains('light-theme');
            document.body.classList.remove('light-theme', 'dark-theme');
            const newTheme = isLight ? 'dark-theme' : 'light-theme';
            document.body.classList.add(newTheme);
            
            // 设置cookie
            document.cookie = `theme=${newTheme};path=/`;
            
            // 直接更新图标
            themeIcon.classList.remove('fa-sun-o', 'fa-moon-o');
            themeIcon.classList.add(newTheme === 'light-theme' ? 'fa-moon-o' : 'fa-sun-o');
            console.log('更新主题图标为:', newTheme === 'light-theme' ? '月亮(深色)' : '太阳(亮色)');
            
            // 更新壁纸遮罩颜色
            const overlay = document.querySelector('.bg-wallpaper-overlay');
            if (overlay) {
              overlay.style.backgroundColor = newTheme === 'light-theme' ? 
                'rgba(255, 255, 255, 0)' : 'rgba(0, 0, 0, 0.5)';
              console.log('更新壁纸遮罩颜色');
            }
            
            // 动画结束后移除类
            setTimeout(() => {
              newThemeToggle.classList.remove('rotating');
            }, 600);
            
            console.log('主题已切换为:', newTheme);
          });
        }
        
        // 添加旋转动画样式
        if (!document.getElementById('theme-toggle-style')) {
          const style = document.createElement('style');
          style.id = 'theme-toggle-style';
          style.textContent = `
            .theme-toggle.rotating {
              animation: rotate360 0.6s ease;
            }
            @keyframes rotate360 {
              from { transform: rotate(0deg); }
              to { transform: rotate(360deg); }
            }
          `;
          document.head.appendChild(style);
        }
      });
    </script>
    <!-- 确保鼠标轨迹效果初始化 -->
    <script>
      // 在页面完全加载后再次确认鼠标轨迹效果已初始化
      window.addEventListener('load', function() {
        setTimeout(() => {
          if (!window.starEffect) {
            console.log('初始化鼠标轨迹效果（延迟加载）');
            window.starEffect = new StarEffect();
          } else if (!window.starEffect.isEnabled) {
            // 读取cookie判断是否应该启用
            const mouseTrailCookie = document.cookie.split(';')
              .find(c => c.trim().startsWith('mouseTrail='));
            const shouldEnable = !mouseTrailCookie || mouseTrailCookie.split('=')[1] === 'true';
            
            if (shouldEnable) {
              console.log('启用鼠标轨迹效果');
              window.starEffect.enable();
              // 更新开关状态
              const toggle = document.getElementById('mouse-trail-toggle');
              if (toggle) {
                toggle.checked = true;
              }
            }
          }
        }, 1000); // 延迟1秒确保其他脚本已加载
      });
    </script>
    <script>
        function initSakanaWidget() {
            // 从cookie中读取状态
            const cookies = document.cookie.split(';');
            const sakanaWidget = cookies.find(cookie => cookie.trim().startsWith('sakanaWidget='));
            const enabled = sakanaWidget ? sakanaWidget.split('=')[1].trim() === 'true' : true;

            if (!enabled) {
                document.getElementById('sakana-widget').style.display = 'none';
                return;
            }
            
            const sakana = new SakanaWidget(sakanaConfig.rightWidget).mount('#sakana-widget');
        }
    </script>
    <script
        async
        onload="initSakanaWidget()"
        src="https://cdn.jsdelivr.net/npm/sakana-widget@2.7.0/lib/sakana.min.js"
    ></script>
  </body>
</html>
